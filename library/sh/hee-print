#!/bin/sh
set -eu

usage() {
  echo "hee-print"
  echo
  echo "USAGE:"
  echo "  hee-print <path|->"
  echo
  echo "BEHAVIOR:"
  echo "  - JSON: jq -C"
  echo "  - YAML: yq -P"
  echo "  - else: pretty via bat (NO wrap) if available; otherwise cat"
}

if [ "${1-}" = "--help" ] || [ "${1-}" = "-h" ]; then usage; exit 0; fi
if [ $# -ne 1 ]; then usage; exit 2; fi

ARG="$1"
TMP=""
F="$ARG"

cleanup() { [ -n "$TMP" ] && rm -f "$TMP" || true; }
trap cleanup EXIT

if [ "$ARG" = "-" ]; then
  TMP="$(mktemp)"
  cat >"$TMP"
  F="$TMP"
fi

# JSON?
if command -v jq >/dev/null 2>&1 && jq -e . "$F" >/dev/null 2>&1; then
  jq -C . "$F"
  exit 0
fi

# YAML?
if command -v yq >/dev/null 2>&1 && yq -e . "$F" >/dev/null 2>&1; then
  yq -P . "$F"
  exit 0
fi

# SVG (local or piped): show raw, unless chafa exists (optional render)
case "$F" in
  *.svg)
    if command -v chafa >/dev/null 2>&1; then
      chafa "$F"
      exit 0
    fi
    ;;
esac

# Markdown/text: bat is fine, but MUST NEVER wrap (wrap breaks URLs)
if command -v batcat >/dev/null 2>&1; then
  batcat --paging=never --wrap=never "$F"
  exit 0
fi
if command -v bat >/dev/null 2>&1; then
  bat --paging=never --wrap=never "$F"
  exit 0
fi

cat "$F"
