#!/bin/sh
# hee: tiny POSIX router entrypoint (bootstrap stool)
# Design: tiny built-ins + extensible fallback to tooling/bin/hee-<cmd>

set -u

usage() {
  cat <<'TXT'
hee â€” tiny router (POSIX sh)

usage:
  hee lint [--mode warn|error]
  hee hooks install [--repo <path>]
  hee help

extension:
  hee <cmd> ... will exec tooling/bin/hee-<cmd> if it exists

notes:
  - default lint mode is warn
  - hooks install is optional; it installs pre-commit symlink
TXT
}

REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || true)"
if [ -z "${REPO_ROOT}" ]; then
  REPO_ROOT="."
fi

cmd="${1:-help}"
shift 2>/dev/null || true

case "${cmd}" in
  lint)
    exec "${REPO_ROOT}/tooling/bin/hee-lint" "$@"
    ;;
  hooks)
    sub="${1:-help}"
    shift 2>/dev/null || true
    case "${sub}" in
      install)
        exec "${REPO_ROOT}/tooling/bin/hee-hooks-install" "$@"
        ;;
      *)
        usage
        exit 0
        ;;
    esac
    ;;
  help|--help|-h|"")
    usage
    exit 0
    ;;
  *)
    # fallback: tooling/bin/hee-<cmd>
    ext="${REPO_ROOT}/tooling/bin/hee-${cmd}"
    if [ -x "${ext}" ]; then
      exec "${ext}" "$@"
    fi
    echo "ðŸŸ¡ ðŸŸ¦ b # WARN: unknown command: ${cmd}" 1>&2
    usage
    exit 0
    ;;
esac
