# HEE Pre-commit Configuration
# Enforces HEE policies and best practices before commits

repos:
  - repo: local
    hooks:
      - id: hee-pager-prevention-check
        name: HEE Pager Prevention Check
        entry: ./scripts/check_pager_prevention.sh
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-state-capsule-validation
        name: HEE State Capsule Validation
        entry: bash -c 'echo "üîç Validating HEE state capsule format..." && if [ -d "docs/STATE_CAPSULES" ]; then echo "‚úÖ State capsule directory found"; else echo "‚ö†Ô∏è  No state capsule directory found"; fi'
        language: system
        files: 'docs/STATE_CAPSULES/.*\.md$'
        pass_filenames: false

      - id: hee-policy-compliance
        name: HEE Policy Compliance Check
        entry: bash -c 'echo "üîç Checking HEE policy compliance..." && if [ -f "docs/HEE_POLICY.md" ]; then echo "‚úÖ HEE policy file found"; else echo "‚ùå HEE policy file missing"; exit 1; fi && if [ -f "prompts/PROMPTING_RULES.md" ]; then echo "‚úÖ Prompting rules found"; else echo "‚ùå Prompting rules missing"; exit 1; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: model-disclosure-check
        name: Model Disclosure Check
        entry: bash -c 'echo "üîç Checking for model disclosure in current commit..." && commit_msg_file="${1:-.git/COMMIT_EDITMSG}" && if [ -f "$commit_msg_file" ]; then commit_msg=$(cat "$commit_msg_file" 2>/dev/null || echo ""); else commit_msg=$(git log --format=%B -n 1 HEAD 2>/dev/null || echo ""); fi && if echo "$commit_msg" | grep -q "\[model:[[:space:]]*[a-zA-Z0-9._-]\+"; then echo "‚úÖ Model disclosure found: $(echo "$commit_msg" | grep -o "\[model:[^]]*\")"; else echo "‚ùå HEE Violation: Model disclosure required"; echo "üìã Format: [model: claude-3.5-sonnet] or [model: gpt-4]"; echo "üí° Add model disclosure to commit message"; echo "üîß Example: git commit -m '\''feat: add feature [model: claude-3.5-sonnet]'\''"; exit 1; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-documentation-check
        name: HEE Documentation Check
        entry: bash -c 'echo "üîç Checking HEE documentation..." && for doc in "docs/HEE.md" "docs/HEER.md" "docs/TROUBLESHOOTING.md" "prompts/INIT.md"; do if [ -f "$doc" ]; then echo "‚úÖ $doc found"; else echo "‚ö†Ô∏è  $doc missing"; fi; done'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-branch-management-check
        name: HEE Branch Management Check
        entry: bash -c 'echo "üîç Checking branch management compliance..." && if [ "$GITHUB_HEAD_REF" != "" ] && [ "$GITHUB_HEAD_REF" != "main" ] && [ "$GITHUB_HEAD_REF" != "master" ]; then if echo "$GITHUB_HEAD_REF" | grep -q "^feature/"; then echo "‚úÖ Feature branch naming followed"; else echo "‚ö†Ô∏è  Branch naming may not follow HEE conventions"; fi; else echo "‚úÖ Main/master branch or no PR context"; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-security-check
        name: HEE Security Check
        entry: bash -c 'echo "üîç Running HEE security checks..." && if grep -r "password\|secret\|key\|token" --include="*.md" --include="*.py" --include="*.js" --include="*.json" . | grep -v "docs/HEE_POLICY.md" | grep -v "prompts/PROMPTING_RULES.md" | grep -v "test\|example\|demo" | head -1; then echo "‚ö†Ô∏è  Potential sensitive information found"; else echo "‚úÖ No obvious security issues"; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-formatting-check
        name: HEE Formatting Check
        entry: bash -c 'echo "üîç Checking HEE formatting standards..." && if [ -f "docs/STATE_CAPSULES/2026-01-24/HEE-Current-Tasks.md" ]; then echo "‚úÖ State capsule formatting check passed"; else echo "‚ö†Ô∏è  State capsule formatting may need attention"; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-violation-check
        name: HEE Violation Prevention Check
        entry: bash -c 'echo "üîç Running HEE violation prevention check..." && ./scripts/violation_checker.sh'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-agent-instruction-check
        name: HEE Agent Instruction Check
        entry: bash -c 'echo "üìã HEE Agent Instructions:" && echo "‚ö†Ô∏è  If this pre-commit hook blocks your commit, it is working correctly!" && echo "üìù Report the violation in your output and document it in the state capsule" && echo "üîß This is expected behavior - the system is preventing violations" && echo "‚úÖ Always update the state capsule with violation reports before pushing" && echo "üéØ Violations should be documented, not bypassed"'
        language: system
        files: '.*'
        pass_filenames: false

  # Standard pre-commit hooks for code quality
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-merge-conflict
      - id: debug-statements

  # Markdown linting
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.37.0
    hooks:
      - id: markdownlint
        args: ['--fix']
        files: '\.md$'

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint.git
    rev: v1.29.0
    hooks:
      - id: yamllint
        args: ['-d', 'relaxed']
        files: '\.(yaml|yml)$'

# Configuration for pre-commit
default_stages: [commit, push]
fail_fast: false

# Exclude patterns
exclude: |
  (?x)^(
      \.git/|
      \.github/|
      node_modules/|
      build/|
      dist/|
      target/|
      \.vscode/|
      \.idea/|
      \.cursor/|
      \.DS_Store|
      \.gitignore|
      \.pre-commit-config\.yaml
  )$
