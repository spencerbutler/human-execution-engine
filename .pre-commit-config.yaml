# HEE Pre-commit Configuration
# Enforces HEE policies and best practices before commits

repos:
  - repo: local
    hooks:
      - id: hee-pager-prevention-check
        name: HEE Pager Prevention Check
        entry: ./scripts/check_pager_prevention.sh
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-conflict-prevention-check
        name: HEE Conflict Prevention Check
        entry: |
          bash -c 'echo "üîç Checking for potential merge conflicts..." && git fetch origin 2>/dev/null && if git diff origin/main...HEAD --exit-code 2>/dev/null; then echo "‚úÖ No conflicts detected with main branch"; else echo "‚ö†Ô∏è  Potential conflicts detected - consider rebasing"; echo "üí° Run: git fetch origin && git rebase origin/main"; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-state-capsule-validation
        name: HEE State Capsule Validation
        entry: | 
          bash -c 'echo "üîç Validating HEE state capsule format..." && if [ -d "docs/STATE_CAPSULES" ]; then echo "‚úÖ State capsule directory found"; else echo "‚ö†Ô∏è  No state capsule directory found"; fi'
        language: system
        files: 'docs/STATE_CAPSULES/.*\.md$'
        pass_filenames: false

      - id: hee-policy-compliance
        name: HEE Policy Compliance Check
        entry: | 
          bash -c 'echo "üîç Checking HEE policy compliance..." && if [ -f "docs/HEE_POLICY.md" ]; then echo "‚úÖ HEE policy file found"; else echo "‚ùå HEE policy file missing"; exit 1; fi && if [ -f "prompts/PROMPTING_RULES.md" ]; then echo "‚úÖ Prompting rules found"; else echo "‚ùå Prompting rules missing"; exit 1; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-documentation-check
        name: HEE Documentation Check
        entry: | 
          bash -c 'echo "üîç Checking HEE documentation..." && for doc in "docs/HEE.md" "docs/HEER.md" "docs/TROUBLESHOOTING.md" "prompts/INIT.md"; do if [ -f "$doc" ]; then echo "‚úÖ $doc found"; else echo "‚ö†Ô∏è  $doc missing"; fi; done'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-branch-management-check
        name: HEE Branch Management Check
        entry: | 
          bash -c 'echo "üîç Checking branch management compliance..." && if [ "$GITHUB_HEAD_REF" != "" ] && [ "$GITHUB_HEAD_REF" != "main" ] && [ "$GITHUB_HEAD_REF" != "master" ]; then if echo "$GITHUB_HEAD_REF" | grep -q "^feature/"; then echo "‚úÖ Feature branch naming followed"; else echo "‚ö†Ô∏è  Branch naming may not follow HEE conventions"; fi; else echo "‚úÖ Main/master branch or no PR context"; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-security-check
        name: HEE Security Check
        entry: | 
          bash -c 'echo "üîç Running HEE security checks..." && if grep -r "password\|secret\|key\|token" --include="*.md" --include="*.py" --include="*.js" --include="*.json" . | grep -v "docs/HEE_POLICY.md" | grep -v "prompts/PROMPTING_RULES.md" | grep -v "test\|example\|demo" | head -1; then echo "‚ö†Ô∏è  Potential sensitive information found"; else echo "‚úÖ No obvious security issues"; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-formatting-check
        name: HEE Formatting Check
        entry: | 
          bash -c 'echo "üîç Checking HEE formatting standards..." && if [ -f "docs/STATE_CAPSULES/2026-01-24/HEE-Current-Tasks.md" ]; then echo "‚úÖ State capsule formatting check passed"; else echo "‚ö†Ô∏è  State capsule formatting may need attention"; fi'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-violation-check
        name: HEE Violation Prevention Check
        entry: | 
          bash -c 'echo "üîç Running HEE violation prevention check..." && ./scripts/violation_checker.sh'
        language: system
        files: '.*'
        pass_filenames: false

      - id: hee-agent-instruction-check
        name: HEE Agent Instruction Check
        entry: | 
          bash -c 'echo "üìã HEE Agent Instructions:" && echo "‚ö†Ô∏è  If this pre-commit hook blocks your commit, it is working correctly!" && echo "üìù Report the violation in your output and document it in the state capsule" && echo "üîß This is expected behavior - the system is preventing violations" && echo "‚úÖ Always update the state capsule with violation reports before pushing" && echo "üéØ Violations should be documented, not bypassed"'
        language: system
        files: '.*'
        pass_filenames: false
      
      - id: markdownlint-cli2-safe-fix
        name: markdownlint (safe autofix)
        entry: scripts/pre-commit/markdownlint-safe-fix
        language: system
        types: [markdown]
        stages: [manual]


  # Standard pre-commit hooks for code quality
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-merge-conflict
      - id: debug-statements

  # Markdown linting
  - repo: https://github.com/DavidAnson/markdownlint-cli2
    rev: v0.20.0
    hooks:
      - id: markdownlint-cli2

  # YAML linting
  - repo: https://github.com/adrienverge/yamllint.git
    rev: v1.38.0
    hooks:
      - id: yamllint
        args: ['-d', 'relaxed']
        files: '\.(yaml|yml)$'

# Configuration for pre-commit
default_stages: [pre-commit, pre-push]
fail_fast: false

# Exclude patterns
exclude: |
  (?x)^(
      \.git/|
      \.github/|
      node_modules/|
      build/|
      dist/|
      target/|
      \.vscode/|
      \.idea/|
      \.cursor/|
      \.DS_Store|
      \.gitignore|
      \.pre-commit-config\.yaml
  )$
